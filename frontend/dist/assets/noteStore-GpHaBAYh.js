const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-ClTo44m5.js","assets/vue-BsGzy4bG.js","assets/pinia-Daj9vj9Q.js","assets/element-plus-icons-DT1t6uiv.js","assets/element-plus-Bsbl4o2M.js","assets/vue-router-DQ646c9T.js","assets/index-CrOCnhgc.css"])))=>i.map(i=>d[i]);
import{d as N}from"./pinia-Daj9vj9Q.js";import{a as m,g as y,b as g,_ as w}from"./index-ClTo44m5.js";import{h as u}from"./element-plus-Bsbl4o2M.js";import{r as v,c as h}from"./vue-BsGzy4bG.js";const $="http://localhost:8000",l=m.create({baseURL:$,timeout:1e4,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{const r=y(),a=g();return r&&(e.headers.Authorization=`${a} ${r}`),e},e=>Promise.reject(e));l.interceptors.response.use(e=>{const{data:r}=e;return r&&typeof r=="object"&&"code"in r?r.code===200?r.data:(u.error(r.message||"请求失败"),Promise.reject(new Error(r.message||"请求失败"))):r},e=>{const{response:r}=e;if(r){const{status:a,data:s}=r;switch(a){case 401:u.error("未授权，请重新登录"),w(async()=>{const{removeToken:i}=await import("./index-ClTo44m5.js").then(d=>d.e);return{removeToken:i}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({removeToken:i})=>{i()}),window.location.href="/login";break;case 403:u.error("拒绝访问");break;case 404:u.error("请求的资源不存在");break;case 500:u.error("服务器内部错误");break;default:u.error(s?.message||"请求失败")}}else u.error("网络错误，请检查网络连接");return Promise.reject(e)});const c="/notes",_=(e={})=>l.get(c,{params:e}),k=e=>l.get(`${c}/${e}`),E=e=>l.post(c,e),T=(e,r)=>l.put(`${c}/${e}`,r),b=e=>l.delete(`${c}/${e}`),A=(e,r={})=>l.get(`${c}/search`,{params:{q:e,...r}}),U=N("note",()=>{const e=v([]),r=v(null),a=v(!1),s=v(null),i=h(()=>e.value.length),d=h(()=>e.value.sort((o,t)=>new Date(t.updatedAt)-new Date(o.updatedAt)).slice(0,5));return{notes:e,currentNote:r,loading:a,error:s,noteCount:i,recentNotes:d,fetchNotes:async(o={})=>{a.value=!0,s.value=null;try{const t=await _(o);e.value=t?.items||[]}catch(t){s.value=t.message,console.error("获取笔记列表失败:",t)}finally{a.value=!1}},fetchNoteById:async o=>{a.value=!0,s.value=null;try{if(!o)throw new Error("无效的笔记ID");const t=await k(o);return r.value=t,t}catch(t){throw s.value=t.message,console.error("获取笔记详情失败:",t),t}finally{a.value=!1}},createNote:async o=>{a.value=!0,s.value=null;try{const t=await E(o);return e.value.unshift(t),t}catch(t){throw s.value=t.message,console.error("创建笔记失败:",t),t}finally{a.value=!1}},updateNote:async(o,t)=>{a.value=!0,s.value=null;try{const n=await T(o,t),f=e.value.findIndex(p=>p.id===o);return f!==-1&&(e.value[f]=n),r.value&&r.value.id===o&&(r.value=n),n}catch(n){throw s.value=n.message,console.error("更新笔记失败:",n),n}finally{a.value=!1}},deleteNote:async o=>{a.value=!0,s.value=null;try{await b(o);const t=e.value.findIndex(n=>n.id===o);t!==-1&&e.value.splice(t,1),r.value&&r.value.id===o&&(r.value=null)}catch(t){throw s.value=t.message,console.error("删除笔记失败:",t),t}finally{a.value=!1}},searchNotes:async(o,t={})=>{a.value=!0,s.value=null;try{return await A(o,t)||[]}catch(n){throw s.value=n.message,console.error("搜索笔记失败:",n),n}finally{a.value=!1}},clearCurrentNote:()=>{r.value=null},reset:()=>{e.value=[],r.value=null,a.value=!1,s.value=null}}});export{U as u};
